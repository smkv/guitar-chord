<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Guitar Chords</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>
<div class="container">
    <h1>Guitar Chords</h1>
    <div class="small">Total <span id="totalCount">0</span> built-in guitar chords.</div>
    <div class="small">Please checking out <a href="https://smkv.github.io/guitar-chord/30-popular-chords.html">the 30
        most popular
        chords</a>.
    </div>

    <div class="input-group my-2">
        <span class="input-group-text"><i class="bi bi-search"></i></span>
        <input type="search" id="chordFilter" class="form-control" placeholder="Search for chords..."/>
    </div>
    <div id="chordList"></div>
    <hr/>
    <div class="small mb-4">Powered by <a href="https://github.com/smkv/guitar-chord">guitar-chord</a> Open-Source
        WebComponent. Copyright
        &copy; 2025 Andrei Samkov
    </div>
</div>
<script src="guitar-chord.js"></script>
<script>
    const chordList = document.getElementById('chordList');
    const chordFilter = document.getElementById('chordFilter');

    document.getElementById('totalCount').textContent = Object.keys(GuitarChord.CHORDS).length;

    function render(names) {
        const chordGroups = new Map([['G', []], ['C', []], ['D', []], ['E', []], ['F', []], ['G', []], ['A', []], ['B', []]]);
        chordList.innerHTML = '';
        for (const name of names) {
            const group = name.charAt(0);
            if (!chordGroups.hasOwnProperty(group)) {
                chordGroups[group] = [];
            }
            chordGroups[group].push(name);
        }

        for (const group in chordGroups) {
            const h2 = document.createElement('h2');
            h2.textContent = group + ' chords';
            chordList.append(h2);
            for (const name of chordGroups[group]) {
                const chord = document.createElement('guitar-chord');
                chord.name = name;
                chordList.append(chord);
            }
        }
    }

    chordFilter.addEventListener('input', function () {
        const filter = chordFilter.value.toLowerCase();
        let names = Object.keys(GuitarChord.CHORDS);
        if (filter !== '') {
            const exactMatch = name => name.toLowerCase() === filter || name.toLowerCase().startsWith(filter + '[');
            const otherMatch = name => !exactMatch(name) && name.toLowerCase().startsWith(filter);
            const nameToFretVersion = name => {
                const regex = /.+\[(\d+)(-(\d+))?]/;
                let result = regex.exec(name);
                return [
                    result && result[1] ? parseInt(result[1]) : 0,
                    result && result[3] ? parseInt(result[3]) : 1,
                ];
            }
            const sortByFretAndVersion = (a, b) => {
                a = nameToFretVersion(a);
                b = nameToFretVersion(b);
                if (a.length !== b.length) {
                    return a.length - b.length;
                }

                for (let i = 0; i < a.length; i++) {
                    if (a[i] !== b[i]) {
                        return a[i] - b[i];
                    }
                }

                return 0;
            };


            names = names.filter(exactMatch).sort(sortByFretAndVersion).concat(names.filter(otherMatch).sort(sortByFretAndVersion));
        }
        if (names.length > 0) {
            render(names);
        } else {
            chordList.innerHTML = 'No chords found';
        }
        window.location.hash = chordFilter.value;
    });

    if (window.location.hash && window.location.hash.length > 1) {
        chordFilter.value = window.location.hash.substring(1);
    }

    chordFilter.dispatchEvent(new Event('input'));

</script>
</body>
</html>